#!/usr/bin/env ruby

require 'gemplate'
require 'userinput'
require 'rugged'
require 'curb'

name = ARGV.first
name = UserInput.new(message: 'Gem name', default: name).ask

user = Rugged::Config.global['github.user'] || ENV['USER']
user = UserInput.new(message: 'GitHub username', default: user).ask

full_name = Rugged::Config.global['user.name']
full_name = UserInput.new(message: 'Full name', default: full_name).ask

email = Rugged::Config.global['user.email']
email = UserInput.new(message: 'Email address', default: email).ask

license_validation = proc do |lname|
  url = "https://raw.githubusercontent.com/akerl/licenses/master/#{lname}.txt"
  Curl::Easy.http_head(url).response_code == 200
end

puts 'Available licenses can be found here: https://github.com/akerl/licenses'
license = UserInput.new(
  message: 'License',
  default: 'MIT',
  validation: license_validation
).ask

Gemplate.new(
  name: name,
  user: user,
  full_name: full_name,
  email: email,
  license: license
).create

puts 'New gem has been created!'
